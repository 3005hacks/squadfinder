<!DOCTYPE html/>
<head>
	<link rel="stylesheet" type="text/css" href="css/feed.css">
	<link rel="stylesheet" type="text/css" href="css/main.css">
	<!--FONTS-->
	<link href='http://fonts.googleapis.com/css?family=Exo' rel='stylesheet' type='text/css'>
	<link href='http://fonts.googleapis.com/css?family=Ubuntu' rel='stylesheet' type='text/css'>
	<link href='http://fonts.googleapis.com/css?family=Roboto' rel='stylesheet' type='text/css'>
	<link href='http://fonts.googleapis.com/css?family=Raleway' rel='stylesheet' type='text/css'>
	<link href='http://fonts.googleapis.com/css?family=Open+Sans+Condensed:300' rel='stylesheet' type='text/css'>

	<!--Importing external JS files-->
	<script src="//www.parsecdn.com/js/parse-1.3.5.min.js"></script>
	<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	<script type="text/javascript" src="js/client.js"></script>

	<title>Squad Feed</title>

    <script src="http://cdn.jsdelivr.net/sockjs/0.3.4/sockjs.min.js"></script>
    <script src="http://cdn.jsdelivr.net/syncanojs/3.1.3beta/syncano.min.js"></script>
    <script src="http://cdn.jsdelivr.net/jquery/2.1.1/jquery.min.js"></script>

</head>

<body >
	<div id="fb-root"></div>
	<!--Facebook Stuff-->

	<script>
	  // Initialize Parse
	  Parse.initialize("m6cPbArnJyhg0yoMeAwU5bpClSXWjZnuTOcaChuq", "3z3mull3Uyyqs6bJLfNTt0uU4sZ5H1VEkjD75NBp");
	 
	  window.fbAsyncInit = function() {
	    Parse.FacebookUtils.init({ // this line replaces FB.init({
	      appId      : '697679580354991', // Facebook App ID
	      status     : false,  // check Facebook Login status
	      cookie     : true,  // enable cookies to allow Parse to access the session
	      xfbml      : true,  // initialize Facebook social plugins on the page
	      version    : 'v2.2' // point to the latest Facebook Graph API version
	    });
	 	
	   // Run code after the Facebook SDK is loaded.
	   document.getElementById("user_profile").innerHTML = Parse.User.current().getUsername();
	  };

	 //Loads Facebook API
	  (function(d, s, id){
	    var js, fjs = d.getElementsByTagName(s)[0];
	    if (d.getElementById(id)) {return;}
	    js = d.createElement(s); js.id = id;
	    js.src = "//connect.facebook.net/en_US/sdk.js";
	    fjs.parentNode.insertBefore(js, fjs);
	  }(document, 'script', 'facebook-jssdk'));
	</script>

	<!--This script holds the logMeIn function to pop up the FB login box-->
	<script type="text/javascript"> function logMeIn(){
		  Parse.FacebookUtils.logIn(null, {
		  success: function(user) {
		    if (!user.existed()) {
		      alert("User signed up and logged in through Facebook!");
		    } else {
		      alert("User logged in through Facebook!");
		    }
		  },
		  error: function(user, error) {
		    alert("User cancelled the Facebook login or did not fully authorize.");
		  }
		});
		}
	</script>




	<!--The visual header of the page. The title, menu bar, etc.-->
	<div class = "header">
		<a href="index.html"><h1 class = "title">squad finder</h1></a>
		<span><a class = "menu_text" href="Profile.html"> Profile<a><a class = "menu_text" href="about.html"> About<a><a class = "logout" onclick="logout()"> Logout<a></span>
	</div></span>

	</div>

	<!--The visual body of the page. Holds all of the main content-->
	<div class = "content">
		<h1></h1>
		<form id="new_post_form">
			<input type="text" id="new_post_title" value="title" onclick="clearText()">
			<input type="text" id="new_post_descript" value="i need a squad for..." onclick="clearText()">
		</form>

		<button id="post_button" onclick="postSquad()">New Post</button>

		<h1 class = "feed_title">My Squad Feed</h1>
		<hr class = "post_bar">

		<!-- The Squad Feed -->
		<div class="feed_div">
			<!--The Div That Holds Squad Posting Information-->
			<div class = "squad_post" id="template" style="display:none">
				<h2 id="squad_title">The BRIT Awards</h2>
				<p id="squad_descript">Hey, guys. I need 30 Goons, ASAP</p>
				<p>Join &nbsp <span> | </span> &nbsp Decline</p>
				<br>
			</div>
		</div>
	</div>



		<!--Creates a New Post-->
	<script type="text/javascript">
		function postSquad(){
				var descript = document.getElementById("new_post_descript").value;
				var title = document.getElementById("new_post_title").value;
				$("#squad_descript").html(descript);
				$("#squad_title").html(title);
				$post = $("#template").clone();
				$post.removeAttr('id');
				$(".feed_div").prepend($post);
				$post.fadeIn();

				document.getElementById("new_post_descript").value = "";
				document.getElementById("new_post_title").value = "";

				var syncano = SyncanoConnector.getInstance(); 
				var PROJECT_ID = 6289;
				var COLLECTION_ID = 18888;

  				var authData = {
    				api_key: "b50a00e33bb198286b779a53666249b90eb3f6dc",
    				instance: "sparkling-meadow-922472"
  				};
  				var PROJECT_ID = 6289;
  				var COLLECTION_ID = 18888;
  
  				syncano.connect(authData, function (auth) {
    			console.log("Connected");
    			var params = {
    			title: title,
    			text: descript,
    			state: 'Moderated',
   				additional: {}
  				};
  
  				syncano.Data.new(PROJECT_ID, COLLECTION_ID, params, function(data){
    				console.log('Created new data object with ID = ', data.id);
  					});
  				});
				//var $div = $("#squad_post").html();
				//$(".content").append($div);
			}
	</script>

	<!-- Removes default text values. -->
	<script type="text/javascript">
		function clearText(){
			var descript = document.getElementById("new_post_descript").value;
			var title = document.getElementById("new_post_title").value;
			if (descript === "i need a squad for...") {
				document.getElementById("new_post_descript").value = "";
				};
			if (title === "title") {
				document.getElementById("new_post_title").value = "";
				};
		}
	</script>
	<script>
		var syncano = SyncanoConnector.getInstance(); 
  		var authData = {
   				api_key: "b50a00e33bb198286b779a53666249b90eb3f6dc",
   				instance: "sparkling-meadow-922472"
   			};
  		var PROJECT_ID = 6289;
  		var COLLECTION_ID = 18888;
  
  		syncano.connect(authData, function (auth) {
   			console.log("Connected");
  		});
  
  		syncano.on('syncano:authorized', function(auth){
   			console.log("authorized");
   		});
  
  		var params = {
   			include_children: false,
   			folders: 'Default'
 		}
  
  		syncano.Data.get(PROJECT_ID, COLLECTION_ID, params, function (data) {
   			console.log('Received', data.length, 'objects');
   			for (i in data) {
  				$("#squad_descript").html(data[i].text);
				$("#squad_title").html(data[i].title);
				$post = $("#template").clone();
				$post.removeAttr('id');
				$(".feed_div").prepend($post);
				$post.fadeIn();
  			};
   			data.forEach(function (d) {
   			    console.log(d);
    		});
  		});

  		syncano.off();
	</script>

</body>

<!--The visual footer at the bottom of the page-->
<footer class = "site-footer">
	<div>
  		<p class="copyright">&#169; 3005 Hacks</p>
	</div>
</footer>
</html>
